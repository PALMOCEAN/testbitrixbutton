<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç–ø—Ä–∞–≤–∫–∞ –ö–ü</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>
        body {
            padding: 15px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        .list-group-item {
            cursor: pointer;
            transition: all 0.2s;
        }
        .list-group-item:hover {
            background-color: #f8f9fa;
            transform: translateX(5px);
        }
        .category-header {
            background-color: #e9ecef;
            font-weight: bold;
            cursor: default;
        }
        .category-header:hover {
            background-color: #e9ecef;
            transform: none;
        }
        #loadButton {
            margin-bottom: 15px;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #6c757d;
        }
        .badge {
            font-size: 0.7em;
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <button id="loadButton" class="btn btn-primary w-100" onclick="loadAnswers()">
            –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ—Ç–≤–µ—Ç—ã
        </button>
        
        <div id="loadingIndicator" class="loading" style="display: none;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤...</p>
        </div>
        
        <ul class="list-group" id="answerList"></ul>
    </div>

<script type="text/javascript">
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–æ–≤ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏
    const templates = {
        'greeting': {
            title: 'üëã –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ',
            items: [
                {
                    title: '–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ',
                    message: '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –†–∞–¥ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤–∞—Å. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?',
                    action: 'greeting',
                    badge: '–°—Ç–∞–Ω–¥–∞—Ä—Ç'
                },
                {
                    title: '–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ (–≤–µ—á–µ—Ä)',
                    message: '–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä! –ß–µ–º –º–æ–≥—É –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω?',
                    action: 'greeting_evening',
                    badge: '–í–µ—á–µ—Ä'
                }
            ]
        },
        'info': {
            title: 'üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
            items: [
                {
                    title: '–°–ø–∏—Å–æ–∫ —Å–∫–ª–∞–¥–æ–≤',
                    message: '–ù–∞—à–∏ —Å–∫–ª–∞–¥—ã:\n1. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, 1\n2. –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –ø—Ä. –°–∫–ª–∞–¥—Å–∫–æ–π, 5\n3. –ö–∞–∑–∞–Ω—å, —É–ª. –õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∞—è, 10',
                    action: 'warehouses_list',
                    badge: '–ê–¥—Ä–µ—Å–∞'
                },
                {
                    title: '–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã',
                    message: '–ú—ã —Ä–∞–±–æ—Ç–∞–µ–º:\n–ü–Ω-–ü—Ç: 9:00 - 18:00\n–°–±: 10:00 - 15:00\n–í—Å: –≤—ã—Ö–æ–¥–Ω–æ–π',
                    action: 'working_hours',
                    badge: '–ì—Ä–∞—Ñ–∏–∫'
                }
            ]
        },
        'shipping': {
            title: 'üöö –î–æ—Å—Ç–∞–≤–∫–∞',
            items: [
                {
                    title: '–£—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏',
                    message: '–î–æ—Å—Ç–∞–≤–∫–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 2-5 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π. –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ –æ—Ç 5000 —Ä—É–±.',
                    action: 'shipping_info',
                    badge: '–ò–Ω—Ñ–æ'
                },
                {
                    title: '–û—Ç—Å–ª–µ–¥–∏—Ç—å –∑–∞–∫–∞–∑',
                    message: '–î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞. –Ø –ø—Ä–æ–≤–µ—Ä—é —Å—Ç–∞—Ç—É—Å –¥–ª—è –≤–∞—Å.',
                    action: 'track_order',
                    badge: '–¢—Ä–µ–∫–∏–Ω–≥'
                }
            ]
        },
        'closing': {
            title: 'üëã –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ',
            items: [
                {
                    title: '–ü—Ä–æ—â–∞–Ω–∏–µ',
                    message: '–°–ø–∞—Å–∏–±–æ –∑–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ! –í—Å–µ–≥–¥–∞ —Ä–∞–¥—ã –ø–æ–º–æ—á—å. –•–æ—Ä–æ—à–µ–≥–æ –¥–Ω—è!',
                    action: 'goodbye',
                    badge: '–°—Ç–∞–Ω–¥–∞—Ä—Ç'
                }
            ]
        }
    };

    let isLoaded = false;

    // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤
    function loadAnswers() {
        if (isLoaded) {
            alert('–û—Ç–≤–µ—Ç—ã —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!');
            return;
        }

        const loadButton = document.getElementById('loadButton');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const answerList = document.getElementById('answerList');

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        loadButton.style.display = 'none';
        loadingIndicator.style.display = 'block';

        // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π API –∑–∞–ø—Ä–æ—Å)
        setTimeout(() => {
            createList();
            loadingIndicator.style.display = 'none';
            isLoaded = true;
        }, 800);
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
    function createList() {
        const answerList = document.getElementById('answerList');
        answerList.innerHTML = '';

        for (const categoryKey in templates) {
            const category = templates[categoryKey];
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            answerList.innerHTML += `
                <li class="list-group-item category-header">
                    ${category.title}
                </li>
            `;

            // –î–æ–±–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            category.items.forEach(item => {
                answerList.innerHTML += `
                    <li class="list-group-item" 
                        onclick="sendMessage('${escapeString(item.message)}', '${item.action}')">
                        ${item.title}
                        ${item.badge ? `<span class="badge bg-secondary">${item.badge}</span>` : ''}
                    </li>
                `;
            });
        }
    }

    // –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –≤—Å—Ç–∞–≤–∫–∏ –≤ HTML
    function escapeString(str) {
        return str.replace(/'/g, "\\'").replace(/"/g, '\\"').replace(/\n/g, '\\n');
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –ª–æ–≥–∏–∫–∏
    function sendMessage(message, action) {
        // –í—ã–ø–æ–ª–Ω—è–µ–º –ª–æ–≥–∏–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–µ–π—Å—Ç–≤–∏—è
        executeAction(action, message);

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
        frameCommunicationSend({
            'action': 'send', 
            'message': message
        });
    }

    // –õ–æ–≥–∏–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π
    function executeAction(actionType, message) {
        console.log(`–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–µ–π—Å—Ç–≤–∏–µ: ${actionType}`);
        
        switch(actionType) {
            case 'greeting':
            case 'greeting_evening':
                // –õ–æ–≥–∏–∫–∞ –¥–ª—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
                console.log('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ');
                // –ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É, –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å, etc
                logToAnalytics('greeting_sent', message);
                break;
                
            case 'warehouses_list':
                console.log('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω —Å–ø–∏—Å–æ–∫ —Å–∫–ª–∞–¥–æ–≤');
                logToAnalytics('warehouses_info_sent', message);
                break;
                
            case 'track_order':
                console.log('–ó–∞–ø—Ä–æ—Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞');
                logToAnalytics('tracking_requested', message);
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤ —Ä–µ–∂–∏–º –æ–∂–∏–¥–∞–Ω–∏—è –Ω–æ–º–µ—Ä–∞ –∑–∞–∫–∞–∑–∞
                break;
                
            case 'shipping_info':
                console.log('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ');
                logToAnalytics('shipping_info_sent', message);
                break;
                
            case 'goodbye':
                console.log('–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞');
                logToAnalytics('conversation_closed', message);
                break;
                
            default:
                console.log('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ:', actionType);
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (–ø—Ä–∏–º–µ—Ä)
    function logToAnalytics(eventName, data) {
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –≤–∞—à—É —Å–∏—Å—Ç–µ–º—É –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
        // –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ Google Analytics, –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫—É –∏–ª–∏ —Å–≤–æ–π —Å–µ—Ä–≤–µ—Ä
        console.log('Analytics:', eventName, data);
        
        // –ü—Ä–∏–º–µ—Ä –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–≤–æ–π —Å–µ—Ä–≤–µ—Ä:
        // fetch('https://your-server.com/analytics', {
        //     method: 'POST',
        //     headers: {'Content-Type': 'application/json'},
        //     body: JSON.stringify({event: eventName, data: data, timestamp: Date.now()})
        // });
    }

    // ============================================
    // Bitrix24 Frame Communication (–∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)
    // ============================================
    
    function frameCommunicationInit() {
        if (!window.frameCommunication) {
            window.frameCommunication = {timeout: {}};
        }
        if(typeof window.postMessage === 'function') {
            window.addEventListener('message', function(event){
                var data = {};
                try { data = JSON.parse(event.data); } catch (err){}

                if (data.action == 'init') {
                    frameCommunication.uniqueLoadId = data.uniqueLoadId;
                    frameCommunication.postMessageSource = event.source;
                    frameCommunication.postMessageOrigin = event.origin;
                }
            });
        }
    }

    function frameCommunicationSend(data) {
        data['uniqueLoadId'] = frameCommunication.uniqueLoadId;
        var encodedData = JSON.stringify(data);
        
        if (!frameCommunication.postMessageOrigin) {
            clearTimeout(frameCommunication.timeout[encodedData]);
            frameCommunication.timeout[encodedData] = setTimeout(function(){
                frameCommunicationSend(data);
            }, 10);
            return true;
        }

        if(typeof window.postMessage === 'function') {
            if(frameCommunication.postMessageSource) {
                frameCommunication.postMessageSource.postMessage(
                    encodedData,
                    frameCommunication.postMessageOrigin
                );
            }
        }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    frameCommunicationInit();
</script>
</body>
</html>
