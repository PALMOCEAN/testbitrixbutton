<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å—Ç—Ä–æ–π–∫–∏</title>
    <script src="//api.bitrix24.com/api/v1/"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-top: 0;
        }
        .status {
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #0c5460;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #0a4451;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ "–¢–µ—Å—Ç –ö–ü"</h1>
        
        <div id="status" class="status info">
            –û–∂–∏–¥–∞–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏...
        </div>
        
        <button id="installBtn" onclick="installPlacement()" disabled>
            –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å—Ç—Ä–æ–π–∫—É
        </button>
        
        <button id="checkBtn" onclick="checkPlacements()" disabled>
            –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ
        </button>
        
        <button id="uninstallBtn" onclick="uninstallPlacement()" disabled>
            –£–¥–∞–ª–∏—Ç—å –≤—Å—Ç—Ä–æ–π–∫—É
        </button>
        
        <div id="result"></div>
    </div>

    <script>
        let isInitialized = false;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è BX24
        BX24.init(function() {
            isInitialized = true;
            document.getElementById('status').innerHTML = '‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ';
            document.getElementById('status').className = 'status success';
            document.getElementById('installBtn').disabled = false;
            document.getElementById('checkBtn').disabled = false;
            document.getElementById('uninstallBtn').disabled = false;
            
            console.log('BX24 –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        });

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å—Ç—Ä–æ–π–∫–∏
        function installPlacement() {
            if (!isInitialized) {
                showError('BX24 –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                return;
            }

            document.getElementById('status').innerHTML = '‚è≥ –£—Å—Ç–∞–Ω–æ–≤–∫–∞...';
            document.getElementById('status').className = 'status info';

            BX24.callMethod(
                'placement.bind',
                {
                    PLACEMENT: 'IM_TEXTAREA_ICON',
                    HANDLER: 'https://palmocean.github.io/testbitrixbutton/test-button.html',
                    TITLE: '–¢–µ—Å—Ç –ö–ü',
                    DESCRIPTION: '–¢–µ—Å—Ç–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ö–ü'
                },
                function(result) {
                    if (result.error()) {
                        showError('–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏: ' + result.error());
                        console.error('–û—à–∏–±–∫–∞:', result.error());
                    } else {
                        showSuccess('–í—Å—Ç—Ä–æ–π–∫–∞ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!<br><br>' +
                                  '<strong>–ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ:</strong><br>' +
                                  '1. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É Bitrix24 (F5)<br>' +
                                  '2. –û—Ç–∫—Ä–æ–π—Ç–µ –ö–æ–Ω—Ç–∞–∫—Ç-—Ü–µ–Ω—Ç—Ä ‚Üí –û—Ç–∫—Ä—ã—Ç—ã–µ –ª–∏–Ω–∏–∏<br>' +
                                  '3. –û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±–æ–π —á–∞—Ç<br>' +
                                  '4. –ù–∞–π–¥–∏—Ç–µ –Ω–æ–≤—É—é –∏–∫–æ–Ω–∫—É –≤–æ–∑–ª–µ –ø–æ–ª—è –≤–≤–æ–¥–∞<br>' +
                                  '5. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –Ω–µ—ë ‚Üí —É–≤–∏–¥–∏—Ç–µ "–¢–µ—Å—Ç –ö–ü"');
                        console.log('–£—Å–ø–µ—à–Ω–æ:', result.data());
                    }
                }
            );
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –≤—Å—Ç—Ä–æ–µ–∫
        function checkPlacements() {
            if (!isInitialized) {
                showError('BX24 –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                return;
            }

            document.getElementById('status').innerHTML = '‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞...';
            document.getElementById('status').className = 'status info';

            BX24.callMethod('placement.list', {}, function(result) {
                if (result.error()) {
                    showError('–û—à–∏–±–∫–∞: ' + result.error());
                } else {
                    const placements = result.data();
                    let html = '<h3>–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –≤—Å—Ç—Ä–æ–π–∫–∏:</h3>';
                    
                    if (placements.length === 0) {
                        html += '<p>–ù–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –≤—Å—Ç—Ä–æ–µ–∫</p>';
                    } else {
                        html += '<pre>' + JSON.stringify(placements, null, 2) + '</pre>';
                    }
                    
                    document.getElementById('result').innerHTML = html;
                    document.getElementById('status').innerHTML = '‚úÖ –ù–∞–π–¥–µ–Ω–æ –≤—Å—Ç—Ä–æ–µ–∫: ' + placements.length;
                    document.getElementById('status').className = 'status success';
                }
            });
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å—Ç—Ä–æ–π–∫–∏
        function uninstallPlacement() {
            if (!isInitialized) {
                showError('BX24 –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                return;
            }

            if (!confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å—Ç—Ä–æ–π–∫—É "–¢–µ—Å—Ç –ö–ü"?')) {
                return;
            }

            document.getElementById('status').innerHTML = '‚è≥ –£–¥–∞–ª–µ–Ω–∏–µ...';
            document.getElementById('status').className = 'status info';

            BX24.callMethod(
                'placement.unbind',
                {
                    PLACEMENT: 'IM_TEXTAREA_ICON',
                    HANDLER: 'https://palmocean.github.io/testbitrixbutton/test-button.html'
                },
                function(result) {
                    if (result.error()) {
                        showError('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + result.error());
                    } else {
                        showSuccess('–í—Å—Ç—Ä–æ–π–∫–∞ —É–¥–∞–ª–µ–Ω–∞!<br>–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É Bitrix24 (F5)');
                        console.log('–£–¥–∞–ª–µ–Ω–æ:', result.data());
                    }
                }
            );
        }

        function showError(message) {
            document.getElementById('status').innerHTML = '‚ùå ' + message;
            document.getElementById('status').className = 'status error';
        }

        function showSuccess(message) {
            document.getElementById('status').innerHTML = '‚úÖ ' + message;
            document.getElementById('status').className = 'status success';
        }
    </script>
</body>
</html>
